<!DOCTYPE html>
<html>
<head>
    <title>Заметки в Google Drive</title>
</head>
<body>
    <h1>Заметки в Google Drive</h1>
    <textarea id="noteText" placeholder="Введите заметку"></textarea>
    <button id="saveButton">Сохранить в Google Drive</button>

    <script>
        // Замените на свой API-ключ
        const API_KEY = 'AIzaSyCTz5JY4g1eosz5DN5Qa4Mg6gKA10v0XK8';
        const CLIENT_ID = '579011393870-5tucmv1mnghemvgm8d0oq2j6gid7pmqf.apps.googleusercontent.com';
        const REDIRECT_URI = 'https://igorgeraskin22.github.io/audio_tags/api.html';
        const SCOPES = 'https://www.googleapis.com/auth/drive.file';

        const authButton = document.getElementById('saveButton');
        const noteText = document.getElementById('noteText');

        authButton.addEventListener('click', handleAuthClick);

        function handleAuthClick() {
            gapi.auth2.authorize(
                {
                    'client_id': CLIENT_ID,
                    'scope': SCOPES,
                    'immediate': false,
                    'response_type': 'token',
                    'redirect_uri': REDIRECT_URI
                },
                handleAuthResult
            );
            return false;
        }

        function handleAuthResult(authResult) {
            if (authResult && !authResult.error) {
                saveNoteToDrive(authResult.access_token, noteText.value);
            } else {
                console.error('Ошибка авторизации: ' + authResult.error);
            }
        }

        function saveNoteToDrive(accessToken, note) {
            gapi.client.load('drive', 'v2', () => {
                const request = gapi.client.request({
                    'path': '/upload/drive/v2/files',
                    'method': 'POST',
                    'params': {
                        'uploadType': 'media'
                    },
                    'headers': {
                        'Authorization': `Bearer ${accessToken}`
                    },
                    'body': note
                });

                request.execute((response) => {
                    if (response.id) {
                        alert('Заметка успешно сохранена в Google Drive!');
                    } else {
                        console.error('Ошибка при сохранении заметки: ' + JSON.stringify(response));
                    }
                });
            });
        }

        // Загрузка и инициализация библиотеки Google API
        gapi.load('client:auth2', initClient);

        function initClient() {
            gapi.client.init({
                apiKey: API_KEY,
                clientId: CLIENT_ID,
                scope: SCOPES
            }).then(() => {
                // API успешно инициализировано
                authButton.disabled = false;
            }).catch((error) => {
                console.error('Ошибка инициализации API: ' + error.details);
            });
        }
    </script>

    <!-- Подключение библиотеки Google API -->
    <script src="https://apis.google.com/js/api.js"></script>
</body>
</html>
